

To run this you'll need:

redis-server

Some python dependencies:
- pip install flask flask_sqlalchemy flask_migrate flask_login rq flask_wtf
flask (1.0.2)
flask_sqlalchemy (2.3.2)
flask_migrate (2.3.0)
flask_login (0.4.1)
rq (0.12.0)
flask_wtf (0.14.2)
Jinja2>=2.10 (from flask) (2.10)
click>=5.1 (from flask) (7.0)
Werkzeug>=0.14 (from flask) (0.14.1)
itsdangerous>=0.24 (from flask) (1.1.0)
SQLAlchemy>=0.8.0 (from flask_sqlalchemy) (1.2.14)
alembic>=0.7 (from flask_migrate) (1.0.2)
redis>=2.7.0 (from rq) (2.10.6)
WTForms (from flask_wtf) (2.2.1)
MarkupSafe>=0.23 (from Jinja2>=2.10->flask) (1.1.0)
Mako (from alembic>=0.7->flask_migrate) (1.0.7)
python-editor>=0.3 (from alembic>=0.7->flask_migrate) (1.0.3)
python-dateutil (from alembic>=0.7->flask_migrate) (2.7.5)
six>=1.5 (from python-dateutil->alembic>=0.7->flask_migrate) (1.11.0)

Create needed folders:
- mkdir upload tmp

To run:
- python worker.py
- python server.py

Pending:
- create another user to run the worker.py
- restrict permissions in folders

Create another user to handle the submissions:
- create user: sudo adduser judge
- set its group to the same as the server
$ sudo groupadd codingchallenges
$ sudo usermod -a -G codingchallenges server
$ sudo usermod -a -G codingchallenges judge
- set server files permission as: chmod -R 700 *
- set server files permission as: chmod -R 700 .*
- set permissions in the server folder: chmod -R 750 *
- set permissions in the tmp folder: chmod 770 tmp

Set firewall rules:
iptables --append OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
 
# create a new chain
iptables --new-chain chk_apache_user
 
# use new chain to process in the judge
iptables -A OUTPUT -m owner --uid-owner judge -j chk_apache_user
 
# Allow the judge to use redis
iptables -A chk_apache_user -p tcp --syn -d 127.0.0.1 --dport 6379  -j RETURN
 
# reject everything else and stop hackers downloading code into our server
iptables -A chk_apache_user -j REJECT


Create private key and certificate:
- openssl req \
       -newkey rsa:2048 -nodes -keyout key.key \
       -x509 -days 365 -out key.crt

The judge command accept commands like this:
cat {input_file} | Rscript {script_file} > {tempfile}; diff --strip-trailing-cr {tempfile} {res_file}


